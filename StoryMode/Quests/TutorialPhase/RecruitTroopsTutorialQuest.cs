using System.Collections.Generic;
using StoryMode.Quests.QuestTasks;
using TaleWorlds.CampaignSystem;
using TaleWorlds.CampaignSystem.Settlements;
using TaleWorlds.Localization;
using TaleWorlds.SaveSystem;

namespace StoryMode.Quests.TutorialPhase;

public class RecruitTroopsTutorialQuest : StoryModeQuestBase
{
	public const int RecruitTroopAmount = 4;

	[SaveableField(1)]
	private readonly RecruitTroopTutorialQuestTask _recruitTroopTutorialQuestTask;

	private TextObject _recruitTroopTaskStartLog => new TextObject("{=vCBuF6dq}Recruit 4 recruits. Click \"Recruit Troops\" option on village menu to recruit troops.");

	public override TextObject Title => new TextObject("{=y3fn2vWY}Recruit Troops");

	public RecruitTroopsTutorialQuest(Hero questGiver)
		: base("recruit_troops_tutorial_quest", questGiver, CampaignTime.Never)
	{
		SetDialogs();
		_recruitTroopTutorialQuestTask = new RecruitTroopTutorialQuestTask(RecruitTaskOnSuccess, 4, DoesRecruitedTroopSatifyRecruitTroopTask, Settlement.CurrentSettlement, AddDiscreteLog(_recruitTroopTaskStartLog, new TextObject("{=y3fn2vWY}Recruit Troops"), 0, 4));
		AddTask(_recruitTroopTutorialQuestTask);
	}

	protected override void SetDialogs()
	{
	}

	protected override void InitializeQuestOnGameLoad()
	{
		SetDialogs();
		_recruitTroopTutorialQuestTask.AddTaskBehaviorsOnGameLoad(RecruitTaskOnSuccess);
		_recruitTroopTutorialQuestTask.InitializeTaskOnLoad(4, DoesRecruitedTroopSatifyRecruitTroopTask, Settlement.Find("village_ES3_2"));
	}

	protected override void HourlyTick()
	{
	}

	private bool DoesRecruitedTroopSatifyRecruitTroopTask(CharacterObject troop)
	{
		return true;
	}

	private void RecruitTaskOnSuccess()
	{
		CompleteQuestWithSuccess();
	}

	internal static void AutoGeneratedStaticCollectObjectsRecruitTroopsTutorialQuest(object o, List<object> collectedObjects)
	{
		((RecruitTroopsTutorialQuest)o).AutoGeneratedInstanceCollectObjects(collectedObjects);
	}

	protected override void AutoGeneratedInstanceCollectObjects(List<object> collectedObjects)
	{
		base.AutoGeneratedInstanceCollectObjects(collectedObjects);
		collectedObjects.Add(_recruitTroopTutorialQuestTask);
	}

	internal static object AutoGeneratedGetMemberValue_recruitTroopTutorialQuestTask(object o)
	{
		return ((RecruitTroopsTutorialQuest)o)._recruitTroopTutorialQuestTask;
	}
}
